.card#transfer-assets-card
  .card-header
    %h1 Send Lumens/Assets
  .card-body
    From Account
    %br
    .address
      = session[:address]
    %hr
    = render partial: "shared/transfer_assets_form"

%script{src: "https://cdnjs.cloudflare.com/ajax/libs/stellar-sdk/0.8.0/stellar-sdk.min.js"}

:javascript
  $(document).ready(function() {
    var selectedValue = $(this).val()
    var assetCode = selectedValue.split(',')[0].replace(/\s/g,'')

    // Display Maximum allowed amount to send,
    // on page load
    $.ajax({
      method: "GET",
      url: "/get_balance",
      data: {code: "XLM"}
    }).done(function(result) {
      $("#available-balance").text(result[0])
      $("#send-max").text("Send Maximum Allowed: " + result[1])
    })
  })
  
  // Display Maximum allowed amount to send,
  // on asset type change
  $('#asset-type').change(function() {
    var selectedValue = $(this).val()
    var assetCode = "XLM"
    if (selectedValue != "Lumens") {
      assetCode = selectedValue.split(',')[0].replace(/\s/g,'')
    }
    $('#send-max').text("Fetching...")
    $("#amount-to-send").val("")
    $("#amount-to-send").attr("placeholder", "Amount to Transfer")

    $.ajax({
      method: "GET",
      url: "/get_balance",
      data: {code: assetCode}
    }).done(function(result) {
      $("#available-balance").text(result[0] + " ")
      $("#send-max").text("Send Maximum Allowed: " + result[1])
    })
  })
  
  $("input[name=memotype]").click(function() {
    $("#memo").prop("disabled", false)
  })

  // set the amount to the max amount allowed
  $('#send-max').click(function() {
    var amount = parseFloat($(this).text().split(":")[1])
    $("#amount-to-send").val(amount)
  })

  // initiate send money
  $('#send_money').click(function(event) {
    var fundAccount = false
    if ($("#fund-new-chk").is(":checked")) {
      fundAccount = true
    }
    processTransfer(fundAccount)
    
  }) // btn click end
